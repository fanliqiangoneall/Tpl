<extend name="HJZF2_Z:basein" />
<block name="content">	
	<style>
		/*会员登录*/
.in_page_main2{width: 100%; min-height: 450px; padding:120px 0; background:url(../img/login_banner.jpg) center;}
.login_bg{ width:697px; box-sizing:border-box; min-height:370px; padding-bottom: 30px; background:#ffffff; border-radius:20px; box-shadow:0 0 5px rgba(0,0,0,0.3);position: relative;
    left: 50%;
    top: 50%;
    transform: translate(-50%,-50%);z-index: 99999;}
.login_title{ text-align:left; font-size:18px; color:#333333; line-height:50px; padding:0 30px; border-bottom:1px solid #f1f1f2;}
.login_nr{ width:500px; margin:auto; padding-top:30px;}
.login_nr_bt{ font-size:32px; color:#333333; line-height:72px; text-align:center;}
.login_nr_row,.login_nr_row1{ padding-top:27px;}
.login_nr_row1 input{width:100%; border:none; box-sizing: border-box; font-size:18px; color:#333333; line-height:30px;}
.register_login_line{width:100%; border-bottom:1px solid #c8c9c9; position:relative;}
.login_nr_row input{ float:left; width:100%; max-width:340px; margin-left:10px; border:none; box-sizing: border-box; font-size:18px; color:#333333; line-height:30px;}
.login_nr_ts{ width:100%; text-align:right;}
.login_nr_ts a{font-size:14px; color:#999999; line-height:30px;}
.login_nr_row input.submit_btn,.login_nr_row1 input.submit_btn{ width:200px; height:40px; float:none; display:block; border:none; margin:auto; margin-top:55px; background:#ef8300; border-radius:20px; text-align:center; font-size:18px; color:#FFFFFF; line-height:40px;}
.login_nr_row input::-moz-placeholder,.login_nr_row1 input::-moz-placeholder {
	color: #333333;
}
.login_nr_row input::-webkit-input-placeholder,.login_nr_row1 input::-webkit-input-placeholder {
        color: #333333;
}   
.login_nr_row input::-ms-input-placeholder,.login_nr_row1 input::-ms-input-placeholder {
        color: #333333;
}
.login_nr_row .yz_alert,.login_nr_row1 .yz_alert{ position:absolute; top:5px; right:5px; z-index:9; color:#FF0000;}
.register_login_title{font-size:18px; color:#333333; line-height:30px; text-align:left; float:left;}
.login_alert{color:#ff0000; position:absolute; top:10px; right:5px; z-index:99;}

@media(max-width:991px){
.in_page_main2{ padding:80px 0;}
.login_bg{ width:85%; height: auto; min-height: 300px;}
.login_nr{ width:90%; margin:auto;}
.login_nr_bt{ font-size:24px; line-height:42px;}
.login_nr_row input,.login_nr_row1 input{ font-size:14px;}
.login_nr_row input.submit_btn,.login_nr_row1 input.submit_btn{width: 120px; height: 30px; font-size: 14px; line-height: 30px;}
}
@media(max-width:768px){
.login_nr_row input{max-width: 200px;}
.login_nr_row input#code_char{ max-width:100px;}
}
#HJZF_Z__wrapper{margin-bottom: 0;}
#main-content-wrapper{
	background: url('{:getindeximgurl($inner_data[0])}') no-repeat center/cover;margin-bottom: 0;height: 100vh;
}
	</style>
	<script>
		
		function yanzheng(){
			var name=$('#name').val();
			if(name.length<=0){
			jQuery("#name_alert").html("用户名必填！");
			count++;
			}
			else{
			jQuery("#name_alert").html("");
			}
			var password=$('#password').val();	
			if(password.length<=0){
			jQuery("#password_alert").html("密码必填！");
			count++;
			}
			else{
			jQuery("#password_alert").html("");
			}
			var prevLink = document.referrer;
			console.log("prevLink"+prevLink);
			if($.trim(prevLink)==''||prevLink.indexOf("Vipapi/insert")!=-1){
				prevLink = '{:U('/')}';
				$('#url').val(prevLink);
			}else{
				$('#url').val(prevLink);
			}
			
			return true;		
		}
		function cleartext(obj){
			$(obj).attr('placeholder','');
		}
		function huifu(obj,text){
			if(!$(obj).val()){
					$(obj).attr('placeholder',text);
			}
		}
		</script>
	<div id="HJZF_Z__wrapper">
			<div class="HJZF_Z__innerContent" id="main-content-wrapper">
				<div class="login_bg">
					<div class="login_nr">	
						<if condition="C('webid') neq 1730">
							<div class="login_nr_bt">登录入口</div>		
							<div class="login_nr_row1">
								<form action="{:U('/auth')}" method="post" onsubmit="return yanzheng()">
									<input type="hidden" name="url" id="url" value="" />
									<div class="register_login_line"><input id="name" placeholder="用户名" onBlur="huifu(this,'用户名')" onFocus="cleartext(this)" style="padding-left:25px;" name="name" /><span><img src="__TMPL__HJZF2_Z/img/contact.png" style="position:absolute; left:0; top:5px; z-index:2;"></span><span class="login_alert" id="name_alert"></span></div>
									<div class="register_login_line" style="margin-top:50px;"><input placeholder="密码" onBlur="huifu(this,'密码')" onFocus="cleartext(this)" id="password" type="password"  style=" padding-left:25px;" name="password" /><span><img src="__TMPL__HJZF2_Z/img/mami.png" style="position:absolute; left:0; top:3px; z-index:2;"></span><span class="login_alert" id="password_alert"></span></div>
									<div class="clear"></div>
									<div class="login_nr_ts"><a href="{:U('/register')}">新用户注册</a>&nbsp;&nbsp;/&nbsp;&nbsp;<a href="{:U('/editpassword')}">忘记密码</a></div>
									<input type="submit" class="submit_btn" value="登陆" />
								</form>
							</div>
							</div>
						<else/>
						<div class="login_nr_bt">登录入口</div>
						<div class="login_nr_row1">
							<form>
								<input type="hidden" name="url" id="url" value="" />
								<div class="register_login_line"><input id="login_name" placeholder="手机号" onBlur="huifu(this,'手机号')" onFocus="cleartext(this)" style="padding-left:25px;" name="mobile" /><span><img src="__TMPL__HJZF2_Z/img/contact.png" style="position:absolute; left:0; top:5px; z-index:2;"></span><span class="login_alert" id="login_name_alert"></span></div>
								<div class="register_login_line" style="margin-top:50px;"><input placeholder="密码" onBlur="huifu(this,'密码')" onFocus="cleartext(this)" id="login_password" type="password"  style=" padding-left:25px;" name="password" /><span><img src="__TMPL__HJZF2_Z/img/mami.png" style="position:absolute; left:0; top:3px; z-index:2;"></span><span class="login_alert" id="login_password_alert"></span></div>
								<div class="clear"></div>
								<div class="login_nr_ts"><a href="{:U('/register')}">新用户注册</a>&nbsp;&nbsp;/&nbsp;&nbsp;<a href="javascript:void(0)" id="resetpassword">忘记密码</a></div>
								<div style="position: relative;"><span class="login_alert" id="login_res_alert" style="left:5px"></span></div>
								<input type="button" class="submit_btn" value="登陆" id="submit_login"/>
							</form>
							<form id="form_restpassword" class="hide">
								<div class="register_login_line"><input id="password_mobile" placeholder="手机号" onBlur="huifu(this,'手机号')" onFocus="cleartext(this)" style="padding-left:25px;" name="mobile" /><span><img src="__TMPL__HJZF2_Z/img/contact.png" style="position:absolute; left:0; top:5px; z-index:2;"></span><span class="login_alert" id="password_mobile_alert"></span></div>
								<div class="register_login_line" style="margin-top:50px;"><input placeholder="输入新密码" onBlur="huifu(this,'输入新密码')" onFocus="cleartext(this)" id="news_password" type="password"  style=" padding-left:25px;" name="password" /><span><img src="__TMPL__HJZF2_Z/img/mami.png" style="position:absolute; left:0; top:3px; z-index:2;"></span><span class="login_alert" id="password_alert"></span></div>
								<div class="clear"></div>								
								<div class="register_login_line" style="margin-top:50px;">
									<div class="register_login_title">验证码：</div>									
									<input type="text" class="input" id="code" name="code" maxlength="6" style="width:150px;" />
									<input type="hidden" class="input" id="verifyCodeId" name="verifyCodeId" />	
									<a href="javascript:void(0);" id="get_verifyCodeId">点击发送手机验证码</a><span class="yz_alert" id="code_char_alert"></span>
									<div class="clear"></div>
								</div>
								<div style="position: relative;"><span class="login_alert" id="change_res_alert" style="left:5px"></span></div>
								<input type="button" class="submit_btn" value="提交" id="submit_password"/>
							</form>
							<script>
								$(document).ready(function(){
									$(document).on('click','#resetpassword',function(){
										$("#form_restpassword").removeClass("hide").siblings("form").addClass('hide');
										$(".login_nr_bt").html("重置密码");
									}).on("click",'#get_verifyCodeId',function(){	
										var mobile = $("#password_mobile").val();
										if(mobile==''){
											$("#password_mobile_alert").html("手机号不能为空");
										}else{
											$("#password_mobile_alert").html("");
											$.ajax({
												type:'post',
												url: "{:U('/index.php/QuinnoidApi/get_I030','','')}",
												async: false,
												data:{
													mobile: mobile,
													codeType: '20'
												},											
												success: function(data){												
													var da = data.slice((data.indexOf('"')+1));																	
													var length = da.length;
													da = da.slice(0,length-2);
													var json_obj = JSON.parse(da);
													console.log(json_obj);
													var message = json_obj.message;
													if(json_obj.code=="U0001"){
														$("#code_char_alert").html("验证码发送成功");
														$("#verifyCodeId").val(json_obj.data.verifyCodeId);														
													}else{
														$("#code_char_alert").html(message);
													}
												},
												error:function(xhr,status,error){
													console.log(xhr);
													console.log(status);
													console.log(error);
												}							
											})
										}
									}).on('click',"#submit_password",function(){
										var mobile = $("#password_mobile").val();
										var code = $("#code").val();
										var verifyCodeId = $("#verifyCodeId").val();
										var news_password = $("#news_password").val();
										$.ajax({
											type:'post',
											url: "{:U('/index.php/QuinnoidApi/get_I042','','')}",
											async: false,
											data:{
												mobile: mobile,
												password:news_password,
												code: code,
												verifyCodeId: verifyCodeId
											},
											success:function(data){
												var da = data.slice((data.indexOf('"')+1));																	
														var length = da.length;
														da = da.slice(0,length-2);
														var json_obj = JSON.parse(da);
														console.log(json_obj);
														if(json_obj.code="U0001"){
															$("#change_res_alert").html("密码重置"+json_obj.message+"，请返回登录");
															setTimeout(function(){
																window.location.href="{:U('/login','','')}";
															},1500);
														}
											}
										})
									}).on('click','#submit_login',function(){
										var mobile = $("#login_name").val();
										var password = $("#login_password").val();
										var url = $("#url").val()
										var count=0;
										if(mobile.length<=0){
											$("#login_name_alert").html("手机号不能为空");
											count++;
										}else{
											$("#login_name_alert").html("");
										}
										if(password.length<=0){
											$("#login_password_alert").html("密码不能为空");
											count++;
										}else{
											$("#login_password_alert").html("");
										}
										if(count>0){
											return false;
										}else{
											$.ajax({
												type:'post',
												url: "{:U('/index.php/QuinnoidApi/get_I041','','')}",
												async: false,
												data:{
													mobile: mobile,
													password:password,
													equipmentNo:11												
												},
												success:function(data){													
													var da = data.slice((data.indexOf('"')+1));																	
														var length = da.length;
														da = da.slice(0,length-2);
														var json_obj = JSON.parse(da);
														console.log(json_obj);	
														if(json_obj.code=="U1901"){
															$("#login_res_alert").html(json_obj.message);
														}else if(json_obj.code=="U1903"){
															$("#login_res_alert").html(json_obj.message);
														}
														else if(json_obj.code=="U0001"){
															$("#login_res_alert").html("");
															localStorage.setItem("login_token", json_obj.data.token);
															localStorage.setItem("userId", json_obj.data.userId);
															localStorage.setItem("loginHisId", json_obj.data.loginHisId);
															if(url.length>0){
																window.location.href=url;
															}else{
																window.location.href="{:U('/')}";
															}
														}							
												}
											})
										}										
									}).on("keyup",function(event){
										if(event.keyCode ==13){
											$("#submit_login").trigger("click");
										}
									})

								})
							</script>
							</div>
						</div>
					</if>
				</div>
		</div>
	</div>
</block>